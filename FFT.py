import math

# 计算RMS值
def calculate_rms(signal):
    sum_of_squares = sum(x**2 for x in signal)
    mean_of_squares = sum_of_squares / len(signal)
    rms_value = math.sqrt(mean_of_squares)
    return rms_value

# 波形检测函数
def detect_waveform(signal, sample_period):
    # 截取整数个周期的信号
    period_samples = int(1 / sample_period)  # 每个周期的采样点数
    num_periods = len(signal) // period_samples  # 整数个周期的数量
    signal = signal[:num_periods * period_samples]  # 截取整数个周期的信号

    # 计算RMS值
    rms_value = calculate_rms(signal)
    
    # 根据RMS值判断波形类型（假设基于经验和已知模板）
    sine_rms = 0.707  # 正弦波的理论RMS值
    square_rms = 1.0  # 方波的理论RMS值
    triangle_rms = 0.577  # 三角波的理论RMS值
    
    if abs(rms_value - sine_rms) < 0.1:
        waveform_type = "Sine Wave"
    elif abs(rms_value - square_rms) < 0.1:
        waveform_type = "Square Wave"
    elif abs(rms_value - triangle_rms) < 0.1:
        waveform_type = "Triangle Wave"
    else:
        waveform_type = "Unknown Waveform"
    
    print(rms_value)
    return {
        "waveform_type": waveform_type,
        "rms_value": rms_value
    }

if __name__ == '__main__':

    # 测试信号三角
    signal =[-2.09, -1.93, -1.83, -1.69, -1.54, -1.41, -1.27, -1.21, -1.08, -0.88, -0.76, -0.62, -0.5, -0.44, -0.28, -0.06, 0.02, 0.24, 0.24, 0.29, 0.49, 0.68, 0.77, 0.88, 1.01, 1.13, 1.24, 1.43, 1.55, 1.71, 1.83, 1.99, 2.16, 2.4, 2.59, 2.81, 3.02, -3.3, -3.3, -3.18, -3.04, -2.92, -2.78, -2.66, -2.55, -2.4, -2.28, -2.15, -2.02, -1.91, -1.78, -1.64, -1.51, -1.38, -1.26, -1.14, -1.01, -0.85, -0.72, -0.61, -0.49, -0.36, -0.25, -0.09, 0.04, 0.15, 0.27, 0.39, 0.51, 0.67, 0.79, 0.93, 1.04, 1.15, 1.3, 1.44, 1.58, 1.72, 1.86, 2.05, 2.22, 2.45, 2.65, 2.85, 3.12, -3.3, -3.27, -3.13, -2.99, -2.9, -2.76, -2.63, -2.52, -2.35, -2.23, -2.11, -2.0, -1.88, -1.77, -1.6, -1.48, -1.37, -1.24, -1.11, -0.99, -0.81, -0.7, -0.58, -0.46, -0.37, -0.21, -0.08, 0.05, 0.16, 0.29, 0.44, 0.56, 0.7, 0.81, 0.94, 1.09, 1.21, 1.32, 1.47, 1.6, 1.77, 1.91, 2.09]
    # 测试信号正弦
    signal1 = [3.16, 3.26, 3.27, 3.14, 2.94, 2.64, 2.33, 1.89, 1.55, 1.22, 0.87, 0.5, 0.16, -0.33, -0.72, -1.11, -1.48, -1.84, -2.14, -2.52, -2.78, -3.0, -3.15, -3.3, -3.3, -3.3, -3.3, -3.3, -3.23, -3.07, -2.85, -2.55, -2.27, -1.95, -1.61, -1.24, -0.86, -0.37, 0.02, 0.36, 0.75, 1.09, 1.43, 1.83, 2.19, 2.53, 2.81, 3.07, 3.2, 3.27, 3.22, 3.08, 2.86, 2.58, 2.22, 1.81, 1.47, 1.14, 0.79, 0.4, 0.05, -0.44, -0.83, -1.18, -1.51, -1.91, -2.23, -2.6, -2.83, -3.04, -3.2, -3.3, -3.3, -3.3, -3.3, -3.3, -3.18, -3.02, -2.81, -2.46, -2.19, -1.86, -1.52, -1.13, -0.77, -0.28, 0.1, 0.46, 0.85, 1.18, 1.51, 1.93, 2.26, 2.62, 2.89, 3.11, 3.27, 3.27, 3.21, 3.03, 2.76, 2.48, 2.15, 1.72, 1.37, 1.05, 0.7, 0.34, -0.04, -0.53, -0.92, -1.28, -1.63, -1.99, -2.3, -2.66, -2.9, -3.08, -3.25, -3.3, -3.3, -3.3, -3.3, -3.27, -3.15, -2.97, -2.74, -2.4]
    #方波
    signal2 = [-3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, 3.27, 3.27, 3.25, 3.26, 3.26, 3.27, 3.27, 3.26, 3.26, 3.26, 3.25, 3.26, 3.25, 3.24, 3.27, 3.27, 3.26, 3.26, 3.26, 3.26, 3.25, 3.27, 3.28, 3.27, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, 3.27, 3.29, 3.26, 3.28, 3.26, 3.28, 3.26, 3.27, 3.26, 3.27, 3.27, 3.27, 3.25, 3.26, 3.27, 3.25, 3.26, 3.25, 3.27, 3.28, 3.26, 3.26, 3.27, 3.26, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, -3.3, 3.26, 3.25, 3.28, 3.27, 3.28, 3.27, 3.28, 3.26, 3.26, 3.29, 3.26, 3.27, 3.26, 3.27, 3.27, 3.27, 3.27, 3.27, 3.28]
    # 假设采样频率为500Hz
    sample_period = 1 / 20

    waveform = detect_waveform(signal1, sample_period)
    print("Waveform:", waveform)
